
from app.prompt.generate_base import USER_PART_EXAMPLE, OPINION_CRITERIA
from app.prompt.parts.generate_part_edit_base import FORMAT_ABSTRACT_OUT, FORMAT_PART_OUT

# 一个专业的[角色定义]
# 核心能力
# - 能力1
# - 能力2
# - 能力3
# 行为准则
# - 始终保持[特定风格]
# - 遵循[特定规范]
# - 禁止[特定行为]
# 输出格式
# - 使用[特定格式]
# - 包含[必要元素]
# 你是顶级金融分析师，专门生成完整可用的研报内容。输出必须是完整的研报正文，无需用户修改。严格禁止输出分隔符、建议性语言或虚构内容。只允许引用真实存在于【财务研报汇总内容】中的图片地址，严禁虚构、猜测、改编图片路径。如引用了不存在的图片，将被判为错误输出。
SYSTEM_PROMPT_PART_EDIT_PART = f"""
你是顶级金融分析师，专门生成完整可用的研报内容。输出必须是完整的研报正文，无需用户修改。严格禁止输出分隔符、建议性语言或虚构内容。只允许引用真实存在于【财务研报汇总内容】中的图片地址，严禁虚构、猜测、改编图片路径。如引用了不存在的图片，将被判为错误输出。
"""
# 未来发展的核心逻辑
# 任务背景：[具体情境描述]
# 具体需求：
# 1.[明确的任务目标]
# 2.[具体的要求细节]
# 3.[期望的输出格式]
# 约束条件：
# - [特定限制]
# - [质量要求]
## 二级章节
# {{subsections}}

# ### 写作框架
# #### 开篇 (Hook)
# - 用一个引人注目的数据或观点开始
# - 明确本章节要解决的核心问题
# - 预告主要结论和投资含义
#
# #### 主体分析 (Analysis)
# 1. **现状描述**：客观呈现当前状况
# 2. **深度剖析**：多维度分析原因和机制
# 3. **对比研究**：历史对比、同业对比、国际对比
# 4. **趋势判断**：基于数据和逻辑的前瞻性分析
# 5. **影响评估**：对公司价值和投资的具体影响
#
# #### 结论总结 (Conclusion)
# - 提炼核心观点和关键数据
# - 明确投资含义和操作建议
# - 指出需要持续关注的风险点
#
# #### 参考文献 (References)
# - 仅在所有正文内容完成后添加
# - 按照正文中引用顺序编号
# - 格式：[编号] 具体数据来源或文献信息

# - part_title: 章节标题（格式："序号. 标题名称"）
# - part_desc: 本部分内容简介（回答1 - 2个核心问题）
# - part_content_type: 说明该部分内容的性质(例如：理论铺垫、数据论证、基础定义、价值论证、现状描述、格局分析等)
# - part_key_output: 本部分需产出的关键结论或成果（例如：明确研究对象的核心定义、研究范围及研究必要性）
# - data_source: 支撑该部分内容的典型数据 / 资料来源（例如：行业词典、政策文件、经典文献等）
# ## 上下文参考
# {{prev_part_content_abstract}}
USER_PROMPT_PART_EDIT_END_PART = f"""
你是一位顶级金融分析师和研报撰写专家。请基于以下内容，直接输出\"{{part_title}}\"这一部分的研报内容。

**重要要求：**
    1. 直接输出完整可用的研报内容，以\"{{part_title_name}}\"开头
    2. 在正文中引用数据、事实、图片等信息时，适当位置插入参考资料符号（如[1][2][3]）
    3. 不要输出任何【xxx开始】【xxx结束】等分隔符
    4. 不要输出\"建议补充\"、\"需要添加\"等提示性语言
    5. 不要编造图片地址或数据
    6. 内容要详实、专业，可直接使用
    7. 使用 “章 - 节 - 目” 三级结构（如 “1.1.1 XXX”），避免层级混乱。

【参考内容】
标题:{{part_title}}
层级类型（章/节/目）:{{part_title_type}}
本部分内容简介:{{part_desc}}
说明该部分内容的性质:{{part_content_type}}
本部分需产出的关键结论或成果:{{part_key_output}}
本部分内容的重要性:{{part_importance}}
建议篇幅占比，控制全文结构平衡:{{part_length_ratio}}

【背景说明开始】
本报告基于自动化采集与分析流程，涵盖如下环节：
- 公司基础信息等数据均通过akshare、公开年报、主流财经数据源自动采集。
- 财务三大报表数据来源：东方财富-港股-财务报表-三大报表 (https://emweb.securities.eastmoney.com/PC_HKF10/FinancialAnalysis/index)
- 主营业务信息来源：同花顺-主营介绍 (https://basic.10jqka.com.cn/new/000066/operate.html)
- 股东结构信息来源：同花顺-股东信息 (https://basic.10jqka.com.cn/HK0020/holder.html) 通过网页爬虫技术自动采集
- 行业信息通过DuckDuckGo等公开搜索引擎自动抓取，引用了权威新闻、研报、公司公告等。
- 财务分析、对比分析、估值与预测均由大模型（如GPT-4）自动生成，结合了行业对标、财务比率、治理结构等多维度内容。
- 相关数据与分析均在脚本自动化流程下完成，确保数据来源可追溯、分析逻辑透明。
- 详细引用与外部链接已在正文中标注。
- 数据接口说明与免责声明见文末。
【背景说明结束】

【财务研报汇总内容开始】
{{report_data}}
【财务研报汇总内容结束】
"""
USER_PROMPT_PART_EDIT_PART = f"""
你是一位顶级金融分析师和研报撰写专家。请基于以下内容，直接输出\"{{part_title}}\"这一部分的研报内容。

**重要要求：**
    1. 直接输出完整可用的研报内容，以\"{{part_title_name}}\"开头
    2. 在正文中引用数据、事实、图片等信息时，适当位置插入参考资料符号（如[1][2][3]），不要在文末生成参考文献列表
    3. 不要输出任何【xxx开始】【xxx结束】等分隔符
    4. 不要输出\"建议补充\"、\"需要添加\"等提示性语言
    5. 不要编造图片地址或数据
    6. 内容要详实、专业，可直接使用
    7. 使用 “章 - 节 - 目” 三级结构（如 “1.1.1 XXX”），避免层级混乱。

【参考内容】
标题:{{part_title}}
层级类型（章/节/目）:{{part_title_type}}
本部分内容简介:{{part_desc}}
说明该部分内容的性质:{{part_content_type}}
本部分需产出的关键结论或成果:{{part_key_output}}
本部分内容的重要性:{{part_importance}}
建议篇幅占比，控制全文结构平衡:{{part_length_ratio}}

【背景说明开始】
本报告基于自动化采集与分析流程，涵盖如下环节：
- 公司基础信息等数据均通过akshare、公开年报、主流财经数据源自动采集。
- 财务三大报表数据来源：东方财富-港股-财务报表-三大报表 (https://emweb.securities.eastmoney.com/PC_HKF10/FinancialAnalysis/index)
- 主营业务信息来源：同花顺-主营介绍 (https://basic.10jqka.com.cn/new/000066/operate.html)
- 股东结构信息来源：同花顺-股东信息 (https://basic.10jqka.com.cn/HK0020/holder.html) 通过网页爬虫技术自动采集
- 行业信息通过DuckDuckGo等公开搜索引擎自动抓取，引用了权威新闻、研报、公司公告等。
- 财务分析、对比分析、估值与预测均由大模型（如GPT-4）自动生成，结合了行业对标、财务比率、治理结构等多维度内容。
- 相关数据与分析均在脚本自动化流程下完成，确保数据来源可追溯、分析逻辑透明。
- 详细引用与外部链接已在正文中标注。
- 数据接口说明与免责声明见文末。
【背景说明结束】

【财务研报汇总内容开始】
{{report_data}}
【财务研报汇总内容结束】
"""
# 【已生成前文】
# {{prev_part_content_abstract}}

USER_PROMPT_PART_EDIT_MODIFY_PART = f"""
你是一位顶级金融分析师和研报撰写专家。请基于修改意见，修改\"{{part_title}}\"这一部分的研报内容。

**重要要求：**
    1. 直接输出完整可用的研报内容，以\"{{part_title_name}}\"开头
    2. 在正文中引用数据、事实、图片等信息时，适当位置插入参考资料符号（如[1][2][3]），不要在文末生成参考文献列表
    3. 不要输出任何【xxx开始】【xxx结束】等分隔符
    4. 不要输出\"建议补充\"、\"需要添加\"等提示性语言
    5. 不要编造图片地址或数据
    6. 内容要详实、专业，可直接使用
    7. 使用 “章 - 节 - 目” 三级结构（如 “1.1.1 XXX”），避免层级混乱。
    
【参考内容】
标题:{{part_title}}
层级类型（章/节/目）:{{part_title_type}}
本部分内容简介:{{part_desc}}
说明该部分内容的性质:{{part_content_type}}
本部分需产出的关键结论或成果:{{part_key_output}}
本部分内容的重要性:{{part_importance}}
建议篇幅占比，控制全文结构平衡:{{part_length_ratio}}
    
【修改的内容开始】
{{cur_content}}
【修改的内容结束】
【修改意见开始】
{{part_content_opinion}}
【修改意见结束】
【财务研报汇总内容开始】
{{report_data}}
【财务研报汇总内容结束】
"""

# ### 公司基础信息
# - 公司全称：[请填写]
# - 股票代码：[请填写]
# - 所属行业：[请填写]
# - 主营业务：[请填写]
# - 市值规模：[请填写]
# - 研报类型：[首次覆盖/深度报告/跟踪报告]
# - 公司特点：[如成长股/价值股/周期股/新兴行业等]
# ### 分析重点与特色要求
# 请根据以下信息进行个性化分析：
#
# - 核心投资主题 ：[如数字化转型、出海战略、技术创新等]
# - 关键分析角度 ：[如盈利模式变化、市场份额提升、成本优化等]
# - 重点关注领域 ：[如新产品发布、政策影响、行业变革等]
# - 差异化视角 ：[请提出独特的分析角度或市场关注点]
# - 目标读者 ：[如机构投资者、个人投资者、行业研究员等]
# 标准
# https://finance.sina.com.cn/stock/stockzmt/2024-11-11/doc-incvsyzf7238509.shtml
# https://stock.hexun.com/2024-05-13/212819524.html
# 数据源
# https://zhuanlan.zhihu.com/p/481982573

# -------
## 内容质量检查清单

### 专业性检查
# - [ ] 使用了准确的金融术语
# - [ ] 分析方法科学合理
# - [ ] 数据来源可靠
# - [ ] 计算过程正确
#
# ### 逻辑性检查
# - [ ] 章节间逻辑连贯
# - [ ] 观点论证充分
# - [ ] 结论与分析一致
# - [ ] 投资建议合理
#
# ### 合规性检查
# - [ ] 保持客观中性
# - [ ] 风险提示充分
# - [ ] 避免误导性表述
# - [ ] 符合监管要求
#
# ### 格式规范检查
# - [ ] Markdown格式正确
# - [ ] 标题层级清晰
# - [ ] 表格格式规范
# - [ ] 重点信息突出

#------

# 数据源整合策略：
# - 财务数据：年报、季报、实时财务指标
# - 市场数据：股价、交易量、技术指标
# - 行业数据：产业链分析、竞争格局
# - 宏观数据：政策环境、经济指标
# - 另类数据：卫星数据、社交媒体情绪
# - 新闻资讯：实时新闻、公告解读

# 五层分析体系：
# L1 - 基础面分析：财务健康度、盈利能力、成长性
# L2 - 行业地位分析：市场份额、竞争优势、护城河
# L3 - 估值分析：多重估值模型、相对估值、绝对估值
# L4 - 风险评估：系统性风险、特定风险、流动性风险
# L5 - 投资策略：时机选择、仓位建议、止盈止损

# 章节定位:
#   章节名称: {章节标题}
#   章节描述: {章节描述}
#   分析重点: {分析重点}
#   关键问题: {要解决的核心问题}